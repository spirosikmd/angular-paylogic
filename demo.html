<!DOCTYPE html>
<html>
<head>
  <title>AngularJS PTA Demo</title>

  <script src="bower_components/angular/angular.min.js"></script>
  <script src="bower_components/angular-resource/angular-resource.min.js"></script>
  <script src="bower_components/angular-base64/angular-base64.min.js"></script>

  <script src="angular-pta.js"></script>
</head>
<body ng-app="demoApp">

  <div ng-controller="mainController">
    <h1>Events</h1>
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Subtitle</th>
          <th>Description</th>
          <th>Long description</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="event in events">
          <td>{{event.title.en}}</td>
          <td>{{event.subtitle.en}}</td>
          <td>{{event.description.en}}</td>
          <td>{{event.long_description.en}}</td>
        </tr>
      </tbody>
    </table>

    <h1>Products</h1>
    <p>Product data for product with uri: {{productUri}}.</p>
    <dl>
      <dt>Availability</dt>
        <dd>{{product.availability}}</dd>
      <dt>Max</dt>
        <dd>{{product.constraints.max_quantity}}</dd>
      <dt>Event</dt>
        <dd>{{product.event}}</dd>
      <dt>Name</dt>
        <dd>{{product.name.en}}</dd>
      <dt>Price</dt>
        <dd>{{product.price.amount}}</dd>
      <dt>Subtitle</dt>
        <dd>{{product.subtitle.en}}</dd>
    </dl>

    <h1>Merchants</h1>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>URI</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="merchant in merchants">
          <td>{{merchant.name.en}}</td>
          <td>{{merchant.uri}}</td>
        </tr>
      </tbody>
    </table>

    <h1>Orders</h1>
    <table>
      <thead>
        <tr>
          <th>Created</th>
          <th>Reference</th>
          <th>State</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="order in orders">
          <td>{{order.created}}</td>
          <td>{{order.reference}}</td>
          <td>{{order.state}}</td>
          <td>{{order.total.amount}}</td>
        </tr>
      </tbody>
    </table>

    <h1>Payment Methods</h1>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Fee</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="paymentmethod in paymentmethods">
          <td>{{paymentmethod.name}}</td>
          <td>{{paymentmethod.description.en}}</td>
          <td>{{paymentmethod.fee}}</td>
        </tr>
      </tbody>
    </table>

    <h1>Locations</h1>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>City</th>
          <th>Country</th>
          <th>Zipcode</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="location in locations">
          <td>{{location.name.en}}</td>
          <td>{{location.city.en}}</td>
          <td>{{location.country}}</td>
          <td>{{location.zipcode}}</td>
        </tr>
      </tbody>
    </table>
  </div>


  <script type="text/javascript">
  (function() {
    'use strict';

    angular.module('demoApp', ['pta'])
      .controller('mainController', function($scope, paylogic) {

        paylogic.events.filter(function(response) {
          $scope.events = response;
        });

        paylogic.locations.filter(function(response) {
          $scope.locations = response;
        });

        $scope.productUri = "https://ticketapi.sandbox.paylogic.com/products/30df20dd0b0e4bc58f0663edc8a4f640";

        paylogic.products.filter({
          uri__eq: $scope.productUri
        }, function(response) {
          $scope.product = response[0];
        });

        var basketUri = "https://ticketapi.sandbox.paylogic.com/baskets/9f27c3aa05274644be9f3703bbfdc846";

        paylogic.baskets.filter({
          uri__eq: basketUri
        }, function(response) {
          var basket = response[0];
          console.log('Basket ', basket.created, 'with uri', basket.uri);
        });

        paylogic.merchants.filter(function(response) {
          $scope.merchants = response;
        });

        // Get all orders.
        paylogic.orders.filter(function(response) {
          $scope.orders = response;
        });

        // Get all payment methods.
        paylogic.paymentmethods.filter(function(response) {
          $scope.paymentmethods = response;
        });

        paylogic.paymentmethods.quote({
          basket: basketUri
        }, function(response) {
          console.log(response);
        });

        // Create a profile with sample json data.
        paylogic.profiles.create({
          'country': 'NL',
          'date_of_birth': '1976-05-24',
          'email': 'unicorn@galaxy.com',
          'first_name': 'Unicorn',
          'gender': 1,
          'last_name': 'Melody'
        }, function(response) {
          var profile = response;
          console.log('Profile created: ', profile);

          // Update profile with new values.
          paylogic.profiles.update({
            profileUid: profile.uri.split('/')[4]
          }, {
            country: 'US',
            first_name: 'Blue Unicorn',
          }, function(response) {
            var updatedProfile = response;
            console.log('Updated profile:', updatedProfile);
          });

          // Filter profiles according to profile uri.
          paylogic.profiles.filter({
            uri__eq: profile.uri
          }, function(response) {
            var newProfile = response[0];
            console.log('Is the same profile?', profile.uri == newProfile.uri);
          });

        });

      });

  }).call(this);
  </script>
</body>
</html>
